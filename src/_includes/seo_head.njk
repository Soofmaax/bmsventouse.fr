{%- set pageUrl = page.url | url -%}
{%- if pageUrl == '/' -%}
  {%- set canonicalComputed = site.url + '/' -%}
{%- else -%}
  {%- set canonicalComputed = site.url + pageUrl -%}
{%- endif -%}
{%- set canonicalHref = canonical or canonicalComputed -%}
{# Robust hreflang alternates computation #}
{%- set frPath = pageUrl -%}
{%- if pageUrl == '/' -%}
  {%- set enPath = '/en/' -%}
{%- else -%}
  {%- set enPath = '/en' + pageUrl -%}
{%- endif -%}
{%- if (pageUrl | replace('/en/','/')) != pageUrl -%}
  {%- set frPath = pageUrl | replace('/en/','/') -%}
  {%- set enPath = pageUrl -%}
{%- endif -%}
{%- set frHref = site.url + frPath -%}
<title>{{ title }}</title>
<meta name="description" content="{{ description }}">
<meta name="theme-color" content="{{ site.themeColor }}">
<meta name="robots" content="{{ robots | default('index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1') }}">
<link rel="canonical" href="{{ canonicalHref }}">
<link rel="alternate" hreflang="fr-FR" href="{{ frHref }}">
<link rel="alternate" hreflang="x-default" href="{{ canonicalHref }}">

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0PKKCL3346"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-0PKKCL3346');
</script>

<script>
  (function(){
    try{
      var k='bms-theme-preference';
      var s=localStorage.getItem(k);
      var m=window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches;
      var dark=s?s==='dark':m;
      if(dark){
        document.documentElement.classList.add('dark-theme');
        document.body&&document.body.classList&&document.body.classList.add('dark-theme');
      }
    }catch(e){ void e; }
  })();
</script>

{# Open Graph / Facebook #}
<meta property="og:title" content="{{ title | escape }}">
<meta property="og:description" content="{{ description | escape }}">
<meta property="og:url" content="{{ canonicalHref }}">
<meta property="og:type" content="{{ ogType or 'website' }}">
<meta property="og:image" content="{{ ogImage or (site.url + '/images/hero-background-custom.jpg') }}">
<meta property="og:locale" content="fr_FR">
<meta property="og:site_name" content="{{ site.brand }}">
{% if ogImageWidth %}<meta property="og:image:width" content="{{ ogImageWidth }}">{% endif %}
{% if ogImageHeight %}<meta property="og:image:height" content="{{ ogImageHeight }}">{% endif %}

{# Twitter Cards #}
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ title | escape }}">
<meta name="twitter:description" content="{{ description | escape }}">
<meta name="twitter:image" content="{{ ogImage or (site.url + '/images/hero-background-custom.jpg') }}">

{# Responsive preload for hero when provided (works for both <img> and CSS background heroes).
   Allow opt-out via heroDefer flag for pages where we intentionally delay the hero image. #}
{% if heroImage and not heroDefer %}
  {% if heroImageMobile %}
<link rel="preload" as="image" imagesrcset="{{ heroImageMobile }} 768w, {{ heroImage }} 1920w" imagesizes="100vw" fetchpriority="high">
  {% else %}
<link rel="preload" as="image" href="{{ heroImage }}" fetchpriority="high">
  {% endif %}
{% endif %}

{# Preload favicon (perf) #}
<link rel="preload" as="image" href="/favicon-32x32.png">

{# Favicon and manifest #}
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="shortcut icon" href="/favicon.ico">

{# CSS, fonts, preconnect #}
<link rel="preload" href="{{ '/css/style.bundle.css' | fingerprint }}" as="style">
<link rel="preload" href="{{ '/js/script.js' | fingerprint }}" as="script">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//www.google-analytics.com">

<link rel="stylesheet" href="{{ '/css/style.bundle.css' | fingerprint }}">
<link rel="stylesheet" href="{{ '/css/components/service-modern.css' | fingerprint }}">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=optional" rel="stylesheet">

{# JSON-LD spécifiques à la page Ventousage #}
{% if page.url == '/services/ventousage/' %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "LocalBusiness",
      "@id": "https://bmsventouse.fr/#business",
      "name": "BMS Ventouse",
      "description": "Expert ventousage et autorisations tournage Paris, Lyon, Marseille. Signalisation conforme, délais optimisés, intervention 24/7.",
      "url": "https://bmsventouse.fr",
      "telephone": "+33646005642",
      "email": "bms.ventouse@gmail.com",
      "address": { "@type": "PostalAddress", "addressCountry": "FR" },
      "areaServed": [
        { "@type": "City", "name": "Paris" },
        { "@type": "City", "name": "Lyon" },
        { "@type": "City", "name": "Marseille" }
      ],
      "hasOfferCatalog": {
        "@type": "OfferCatalog",
        "name": "Services de ventousage",
        "itemListElement": [
          { "@type": "Offer", "itemOffered": { "@type": "Service", "name": "Ventousage Paris", "description": "Autorisations tournage Paris, neutralisation stationnement, signalisation conforme" } },
          { "@type": "Offer", "itemOffered": { "@type": "Service", "name": "Ventousage Lyon", "description": "Autorisations tournage Lyon, zones UNESCO, coordination TCL" } },
          { "@type": "Offer", "itemOffered": { "@type": "Service", "name": "Ventousage Marseille", "description": "Autorisations tournage Marseille, adaptation mistral, centre historique" } }
        ]
      },
      "openingHoursSpecification": {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],
        "opens": "00:00",
        "closes": "23:59"
      }
    },
    {
      "@type": "WebPage",
      "@id": "https://bmsventouse.fr/services/ventousage/#webpage",
      "url": "https://bmsventouse.fr/services/ventousage/",
      "name": "Ventousage Paris, Lyon, Marseille | BMS Ventouse",
      "description": "Expert ventousage autorisations tournage. Délais 48h Paris, 3-5j Lyon/Marseille. Signalisation conforme garantie. Devis gratuit sous 2h.",
      "inLanguage": "fr-FR",
      "breadcrumb": {
        "@type": "BreadcrumbList",
        "itemListElement": [
          { "@type": "ListItem", "position": 1, "name": "Accueil", "item": "https://bmsventouse.fr" },
          { "@type": "ListItem", "position": 2, "name": "Services", "item": "https://bmsventouse.fr/services" },
          { "@type": "ListItem", "position": 3, "name": "Ventousage", "item": "https://bmsventouse.fr/services/ventousage" }
        ]
      }
    },
    {
      "@type": "FAQPage",
      "@id": "https://bmsventouse.fr/services/ventousage/#faq",
      "mainEntity": [
        { "@type": "Question", "name": "Comment obtenir des autorisations de tournage à Paris rapidement ?", "acceptedAnswer": { "@type": "Answer", "text": "BMS Ventouse gère l'ensemble des démarches administratives pour les autorisations de tournage à Paris. Délais standard : 48-72h pour les zones classiques, 5-10 jours pour les zones sensibles." } },
        { "@type": "Question", "name": "Quels sont les délais pour un ventousage à Lyon ?", "acceptedAnswer": { "@type": "Answer", "text": "Pour un ventousage Lyon, nos délais sont de 3-5 jours ouvrés. Nous coordonnons avec la Métropole de Lyon et gérons les spécificités des zones UNESCO." } }
      ]
    }
  ]
}
</script>
{% endif %}

{# JSON-LD Schema.org (WebSite, Organization, BreadcrumbList) #}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebSite",
      "url": "{{ site.url }}",
      "name": "{{ site.brand }}",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "{{ site.url }}/search/?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    },
    {
      "@type": "Organization",
      "name": "{{ site.brand }}",
      "url": "{{ site.url }}",
      "logo": "{{ site.url }}/android-chrome-512x512.png",
      "sameAs": [
        "https://www.linkedin.com/company/bms-ventouse",
        "https://www.facebook.com/bmsventouse"
      ]
    },
    {
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Accueil",
          "item": "{{ site.url }}/"
        },
        {%- if breadcrumbs -%}
          {%- for crumb in breadcrumbs %}
          ,{
            "@type": "ListItem",
            "position": {{ loop.index + 1 }},
            "name": "{{ crumb.name }}",
            "item": "{{ site.url }}{{ crumb.url }}"
          }
          {%- endfor -%}
        {%- endif -%}
      ]
    }
  ]
}
</script>